@using ZedCars.Net8.ViewModels.HomeCont
@model List<MyPurchaseViewModel>

@{
    ViewData["Title"] = "My Purchases";
}

<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-gradient">
            <i class="bi bi-bag-check-fill me-2"></i> My Purchases
        </h2>
    </div>

    @if (Model == null || !Model.Any())
    {
        <div class="alert alert-info text-center shadow-sm rounded-3">
            <i class="bi bi-info-circle me-2"></i> You have not purchased anything yet.
        </div>
    }
    else
    {
        <div class="d-flex flex-column gap-4">
            @foreach (var item in Model)
            {
                var car = item.Car;
                var purchase = item.Purchase;
                var accessories = purchase?.SelectedAccessoriesString;
                var accessoryPurchaseOnly = item?.AccessoryPurchaseOnly;

                @if (car != null && purchase != null)
                {
                    <div class="card purchase-card border-0 shadow-lg overflow-hidden">
                        <div class="row g-0 align-items-center">
                            <!-- Image Section -->
                            <div class="col-md-6">
                                <img src="@car.ImageUrl" alt="@car.Model" class="img-fluid h-100 w-100 car-img" style="object-fit: cover;" />
                            </div>

                            <!-- Content Section -->
                            <div class="col-md-6">
                                <div class="card-body p-4">
                                    <!-- Brand & Price -->
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h3 class="fw-bold mb-0">@car.Brand - <span>@car.Model</span></h3>
                                        <span class="badge bg-success fs-6">$@purchase.PurchasePrice</span>
                                    </div>

                                    <!-- Basic Info -->
                                    <div class="row text-secondary mb-4">
                                        <div class="col-6 mb-2">
                                            <i class="bi bi-calendar-check me-2 text-primary"></i>
                                            <strong>Year:</strong> @car.Year
                                        </div>
                                        <div class="col-6 mb-2">
                                            <i class="bi bi-123 me-2 text-primary"></i>
                                            <strong>Quantity:</strong> @purchase.PurchaseQuantity
                                        </div>
                                        <div class="col-6 mb-2">
                                            <i class="bi bi-speedometer2 me-2 text-primary"></i>
                                            <strong>Mileage:</strong> @car.Mileage km
                                        </div>
                                        <div class="col-6 mb-2">
                                            <i class="bi bi-palette me-2 text-primary"></i>
                                            <strong>Color:</strong> @car.Color
                                        </div>
                                        <div class="col-6 mb-2">
                                            <i class="bi bi-fuel-pump me-2 text-primary"></i>
                                            <strong>FuelType:</strong> @car.FuelType
                                        </div>
                                        <div class="col-6 mb-2">
                                            <i class="bi bi-gear-fill me-2 text-primary"></i>
                                            <strong>Transmission:</strong> @car.Transmission
                                        </div>
                                    </div>

                                    <!-- Accessories -->
                                    <div class="col-12 text-secondary">
                                        <i class="bi bi-gear-fill me-2 text-primary"></i>
                                        <strong>Accessories:</strong> @accessories
                                    </div>

                                    <!-- Action Button -->
                                    <div class="d-flex justify-content-end mt-1">
                                        <a href="/Home/VehicleDetail/@car.CarId" class="btn btn-primary px-4 rounded-pill shadow-sm">
                                            <i class="bi bi-eye me-2"></i> View Details
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }

                @if (accessoryPurchaseOnly != null)
                {
                    <div class="card purchase-card border-0 shadow-lg overflow-hidden">
                        <div class="card-body p-4">
                            <!-- Header -->
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h3 class="fw-bold mb-0">
                                    <i class="bi bi-gear-fill me-2"></i> Accessories Purchase
                                </h3>
                                <span class="badge bg-success fs-6">$@accessoryPurchaseOnly.TotalPrice</span>
                            </div>

                            <!-- Buyer Info -->
                            <div class="row text-secondary mb-4">
                                <div class="col-6 mb-2">
                                    <i class="bi bi-calendar-check me-2 text-primary"></i>
                                    <strong>Date:</strong> @accessoryPurchaseOnly.PurchaseDate.ToString("yyyy-MM-dd")
                                </div>
                                <div class="col-6 mb-2">
                                    <i class="bi bi-person me-2 text-primary"></i>
                                    <strong>Buyer:</strong> @accessoryPurchaseOnly.BuyerName
                                </div>
                            </div>

                            <!-- Accessories List -->
                            <div class="col-12 text-secondary">
                                <i class="bi bi-list-ul me-2 text-primary"></i>
                                <strong>Accessories:</strong>
                                @if (accessoryPurchaseOnly.SelectedAccessories != null && accessoryPurchaseOnly.SelectedAccessories.Any())
                                {
                                    <div class="mt-2 d-flex flex-wrap gap-2">
                                        @foreach (var acc in accessoryPurchaseOnly.SelectedAccessories)
                                        {
                                            <span class="badge bg-light text-dark border shadow-sm px-3 py-2">@acc</span>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <span class="text-muted">No accessories selected</span>
                                }
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
    }
</div>

<style>
    /* Gradient Title */
    .text-gradient {
        background: linear-gradient(90deg, #0d6efd, #6610f2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* Purchase Card Styling */
    .purchase-card {
        border-radius: 1rem;
        transition: transform 0.25s ease, box-shadow 0.25s ease;
        background-color: #ffffff;
    }

        .purchase-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.15);
        }

    /* Image Styling */
    .car-img {
        border-top-left-radius: 1rem;
        border-bottom-left-radius: 1rem;
        height: 100%;
        min-height: 280px;
    }

    body {
        background-color: #f8f9fa;
    }
</style>
